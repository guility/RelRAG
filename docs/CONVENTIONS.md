# Конвенции и архитектурные соглашения

Документ фиксирует **решения, принятые при эскалации конфликтов** (3-й возврат задачи на доработку). Архитектор анализирует причины, вносит исправления в задачи/контракты и фиксирует итог здесь и в ADR.

---

## Установленные конвенции

### Формат ошибок API

Все ошибки API возвращаются в едином JSON-формате:

```json
{
  "error": {
    "code": "PERMISSION_DENIED",
    "message": "User does not have write access to this collection",
    "details": {}
  }
}
```

| Поле | Описание |
|------|----------|
| `code` | Код ошибки: `PERMISSION_DENIED`, `NOT_FOUND`, `VALIDATION_ERROR`, `DUPLICATE_DOCUMENT`, `UNAUTHORIZED`, `INTERNAL_ERROR` |
| `message` | Человекочитаемое описание |
| `details` | Дополнительные данные (опционально) |

HTTP-коды: 400 (validation), 401 (unauthorized), 403 (permission denied), 404 (not found), 409 (conflict), 500 (internal).

---

## Как попадают сюда записи

При **третьем возврате** задачи на доработку:

1. Архитектор анализирует причины конфликта
2. Вносит исправления в задачи ([TASKS.md](TASKS.md)), контракты (ports, DTO) или план
3. Добавляет запись в этот файл
4. Создаёт ADR в `docs/adr/` с обоснованием решения

---

## Шаблон записи конвенции

```markdown
### CONV-YYYY-MM-DD-NNN

| Поле | Значение |
|------|----------|
| **Дата** | YYYY-MM-DD |
| **Связанный конфликт** | CONFLICT-YYYY-MM-DD-NNN |
| **Задача** | T2.1 |
| **Архитектор** | Имя |

**Проблема**: Краткое описание корневой причины конфликта.

**Решение**: Что изменено (задачи, контракты, структура).

**ADR**: [ADR-XXXX](adr/XXXX-title.md)
```

---

## Записи

*(Добавляются при эскалации конфликтов)*
